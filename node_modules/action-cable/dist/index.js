'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = open;

var _Rx = require('rxjs/Rx');

var _Rx2 = _interopRequireDefault(_Rx);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function open(url, channel) {
  var identifier = JSON.stringify({ channel: channel });
  var socket = new WebSocket(url);
  var subject = new _Rx2.default.Subject();

  socket.onmessage = function (event) {
    var data = JSON.parse(event.data);
    if (data.identifier === identifier && data.type === 'message') {
      subject.next(data.message);
    }
  };

  socket.onopen = function () {
    socket.send(JSON.stringify({ command: 'subscribe', identifier: identifier }));
  };

  socket.onclose = function () {
    subject.complete();
  };

  subject.close = function () {
    return socket.close();
  };

  return subject;
}